<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Tr√°mites</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        header h1 { color: #2c3e50; font-size: 28px; }
        .header-buttons { display: flex; gap: 10px; }
        .btn-primary {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); }
        .filtros {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filtros label { font-weight: 600; color: #2c3e50; }
        .filtros input, .filtros select {
            padding: 10px 15px;
            border: 2px solid #e8eaff;
            border-radius: 6px;
            font-size: 14px;
        }
        .filtros input:focus, .filtros select:focus {
            outline: none;
            border-color: #667eea;
        }
        .categorias { display: grid; gap: 25px; }
        .categoria { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .categoria-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .categoria-header h2 { font-size: 20px; font-weight: 600; }
        .categoria-content { padding: 20px; }
        .tramites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .tramite-card {
            background: #f8fafb;
            border: 2px solid #e8eaff;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tramite-card:hover { border-color: #667eea; transform: translateY(-2px); }
        .tramite-card h3 { color: #2c3e50; margin-bottom: 8px; }
        .tramite-card p { color: #5a6c7d; font-size: 14px; margin-bottom: 10px; }
        .tramite-badges { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .tramite-badge {
            display: inline-block;
            background: #e8eaff;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .estado-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .estado-agregar { background: #d4edda; color: #155724; }
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            overflow-y: auto;
        }
        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 30px;
            border-radius: 12px;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .close {
            color: #a0aec0;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal h2 { color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .modal-section { margin-bottom: 20px; }
        .modal-section h3 { color: #2c3e50; font-size: 16px; margin-bottom: 10px; border-left: 4px solid #667eea; padding-left: 12px; }
        .modal-section p { color: #5a6c7d; line-height: 1.8; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e8eaff;
        }
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #5a6c7d;
            border-bottom: 3px solid transparent;
        }
        .tab.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e8eaff;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .etapas-section { background: #f8fafb; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #e8eaff; }
        .etapa-editor-item { background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #667eea; }
        .btn-agregar-etapa {
            background: #667eea;
            color: white;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; flex-wrap: wrap; }
        .btn-modal { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-cerrar { background: #e8eef5; color: #2c3e50; }
        .btn-guardar { background: #7fb069; color: white; }
        .password-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        .password-content {
            background-color: white;
            margin: 15% auto;
            padding: 40px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .password-content h3 { color: #2c3e50; margin-bottom: 20px; }
        .password-group { margin-bottom: 20px; }
        .password-group label { display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
        .password-group input { width: 100%; padding: 12px; border: 2px solid #e8eaff; border-radius: 6px; }
        .password-group input:focus { outline: none; border-color: #667eea; }
        .password-buttons { display: flex; gap: 10px; justify-content: flex-end; }
        .btn-password { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-confirmar { background: #7fb069; color: white; }
        .btn-cancelar-pass { background: #e8eef5; color: #2c3e50; }
        .btn-ver { background: #667eea; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .info-item { background: #f8fafb; padding: 12px; border-radius: 6px; border-left: 4px solid #667eea; }
        .info-item strong { color: #2c3e50; display: block; margin-bottom: 5px; }
        .info-item span { color: #5a6c7d; font-size: 13px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Sistema de Gesti√≥n de Tr√°mites</h1>
            <div class="header-buttons">
                <button class="btn-primary" onclick="abrirNuevoTramite()">‚ûï Agregar Tr√°mite</button>
            </div>
        </header>

        <div class="filtros">
            <label for="filtroNombre">üîç Buscar:</label>
            <input type="text" id="filtroNombre" placeholder="Buscar tr√°mite...">
            <label for="filtroCategoria">üìÇ Categor√≠a:</label>
            <select id="filtroCategoria">
                <option value="">Todas</option>
            </select>
            <button class="btn-primary" onclick="resetFiltros()">üîÑ Limpiar</button>
        </div>

        <div class="categorias" id="categoriasContainer"></div>
    </div>

    <div id="modalVer" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalVer()">&times;</span>
            <div id="detalleContenido"></div>
            <div class="modal-buttons">
                <button class="btn-modal btn-cerrar" onclick="cerrarModalVer()">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="modalEdicion" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalEdicion()">&times;</span>
            <h2>Agregar Nuevo Tr√°mite</h2>
            <div class="tabs">
                <button class="tab active" onclick="cambiarTab(this, 'info-tab')">üìã Informaci√≥n</button>
                <button class="tab" onclick="cambiarTab(this, 'etapas-tab')">üìç Etapas</button>
                <button class="tab" onclick="cambiarTab(this, 'requisitos-tab')">‚úÖ Requisitos</button>
            </div>

            <div id="info-tab" class="tab-content active">
                <div class="form-group">
                    <label>Nombre del Tr√°mite *</label>
                    <input type="text" id="nombreTramite" placeholder="Nombre...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Clave *</label>
                        <input type="number" id="claveTramite" placeholder="Clave...">
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="estadoTramite">
                            <option>Se queda igual</option>
                            <option>Se modific√≥</option>
                            <option>Agregar</option>
                            <option>Eliminar</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Categor√≠a *</label>
                        <select id="categoriaTramite"></select>
                    </div>
                    <div class="form-group">
                        <label>Filtros</label>
                        <input type="text" id="filtrosTramite" placeholder="Filtros...">
                    </div>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n *</label>
                    <textarea id="descripcionTramite" placeholder="Descripci√≥n..."></textarea>
                </div>
                <div class="form-group">
                    <label>Presupuesto</label>
                    <input type="text" id="presupuestoTramite" placeholder="Presupuesto...">
                </div>
                <div class="form-group">
                    <label>Resultado</label>
                    <textarea id="resultadoTramite" placeholder="Resultado..."></textarea>
                </div>
            </div>

            <div id="etapas-tab" class="tab-content">
                <div class="etapas-section" id="etapasContainer"></div>
                <button class="btn-agregar-etapa" onclick="agregarEtapa()">‚ûï Agregar Etapa</button>
            </div>

            <div id="requisitos-tab" class="tab-content">
                <div class="form-group">
                    <label>Requisitos *</label>
                    <textarea id="requisitosTramite" placeholder="Requisitos..."></textarea>
                </div>
                <div class="form-group">
                    <label>√ìrdenes de Trabajo</label>
                    <input type="text" id="ordenesTrabajo" placeholder="OT-001, OT-002...">
                </div>
            </div>

            <div class="modal-buttons">
                <button class="btn-modal btn-guardar" onclick="guardarTramite()">üíæ Guardar</button>
                <button class="btn-modal btn-cerrar" onclick="cerrarModalEdicion()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <div id="passwordModal" class="password-modal">
        <div class="password-content">
            <h3>üîê Contrase√±a requerida</h3>
            <div class="password-group">
                <label for="passwordInput">Contrase√±a:</label>
                <input type="password" id="passwordInput" placeholder="Ingresa contrase√±a...">
            </div>
            <div class="password-buttons">
                <button class="btn-password btn-confirmar" onclick="verificarContrasena()">Aceptar</button>
                <button class="btn-password btn-cancelar-pass" onclick="cerrarPasswordModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const CONTRASENA = "admin123";
        let datosGlobales = {
            categorias: [
                { id: 1, nombre: "Control de Obligaciones", tramites: [] },
                { id: 2, nombre: "Notificaciones y Cobranza", tramites: [] },
                { id: 3, nombre: "Contrataci√≥n", tramites: [] },
                { id: 4, nombre: "Contrataci√≥n en Parcialidades", tramites: [] },
                { id: 5, nombre: "Especial", tramites: [] },
                { id: 6, nombre: "General", tramites: [] },
                { id: 7, nombre: "Medidores", tramites: [] },
                { id: 8, nombre: "Grandes Usuarios", tramites: [] },
                { id: 9, nombre: "Mantenimiento", tramites: [] },
                { id: 10, nombre: "Padr√≥n y Lectura", tramites: [] }
            ]
        };
        let accionPendiente = null;
        let datosAccion = null;

        function cargarDatos() {
            const datos = localStorage.getItem('tramitesData');
            if (datos) datosGlobales = JSON.parse(datos);
        }

        function guardarDatos() {
            localStorage.setItem('tramitesData', JSON.stringify(datosGlobales));
        }

        function renderizar() {
            const container = document.getElementById('categoriasContainer');
            const filtroNombre = document.getElementById('filtroNombre').value.toLowerCase();
            const filtroCategoria = document.getElementById('filtroCategoria').value;
            container.innerHTML = '';

            datosGlobales.categorias.forEach(categoria => {
                if (filtroCategoria && categoria.id != filtroCategoria) return;
                const tramitesFiltrados = categoria.tramites.filter(t =>
                    t.nombre.toLowerCase().includes(filtroNombre) ||
                    t.descripcion.toLowerCase().includes(filtroNombre)
                );

                const div = document.createElement('div');
                div.className = 'categoria';
                let html = `<div class="categoria-header"><h2>${categoria.nombre}</h2></div><div class="categoria-content"><div class="tramites-grid">`;
                
                tramitesFiltrados.forEach(tramite => {
                    html += `<div class="tramite-card">
                        <h3>${tramite.nombre}</h3>
                        <p>${tramite.descripcion}</p>
                        <div class="tramite-badges">
                            <span class="tramite-badge">üìã ${tramite.etapas.length} etapas</span>
                        </div>
                        <button class="btn-ver" style="width: 100%; margin-top: 10px;" onclick="verTramite(${tramite.clave}, ${categoria.id})">üëÅÔ∏è Ver Detalles</button>
                    </div>`;
                });
                
                html += '</div></div>';
                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        function verTramite(clave, categoriaId) {
            const categoria = datosGlobales.categorias.find(c => c.id === categoriaId);
            const tramite = categoria.tramites.find(t => t.clave === clave);

            let html = `<h2>${tramite.nombre}</h2>
                <div class="info-grid">
                    <div class="info-item"><strong>Clave:</strong> <span>${tramite.clave}</span></div>
                    <div class="info-item"><strong>Categor√≠a:</strong> <span>${categoria.nombre}</span></div>
                </div>
                <div class="modal-section">
                    <h3>Descripci√≥n</h3>
                    <p>${tramite.descripcion}</p>
                </div>
                <div class="modal-section">
                    <h3>Requisitos</h3>
                    <p>${tramite.requisitos}</p>
                </div>`;
            
            if (tramite.etapas && tramite.etapas.length > 0) {
                html += '<div class="modal-section"><h3>Etapas</h3>';
                tramite.etapas.forEach((e, i) => {
                    html += `<p><strong>Etapa ${i+1}:</strong> ${e.nombre} - ${e.descripcion}</p>`;
                });
                html += '</div>';
            }

            document.getElementById('detalleContenido').innerHTML = html;
            document.getElementById('modalVer').style.display = 'block';
        }

        function cerrarModalVer() {
            document.getElementById('modalVer').style.display = 'none';
        }

        function abrirNuevoTramite() {
            limpiarFormulario();
            document.getElementById('modalEdicion').style.display = 'block';
            renderizarEtapas([{ nombre: '', descripcion: '' }]);
        }

        function limpiarFormulario() {
            document.getElementById('nombreTramite').value = '';
            document.getElementById('claveTramite').value = '';
            document.getElementById('estadoTramite').value = 'Se queda igual';
            document.getElementById('categoriaTramite').value = '';
            document.getElementById('filtrosTramite').value = '';
            document.getElementById('descripcionTramite').value = '';
            document.getElementById('presupuestoTramite').value = '';
            document.getElementById('requisitosTramite').value = '';
            document.getElementById('ordenesTrabajo').value = '';
            document.getElementById('resultadoTramite').value = '';
        }

        function renderizarEtapas(etapas) {
            const html = etapas.map((e, i) => `
                <div class="etapa-editor-item">
                    <label>Etapa ${i + 1}</label>
                    <input type="text" placeholder="Nombre" value="${e.nombre}" onchange="actualizarEtapa(${i}, 'nombre', this.value)">
                    <input type="text" placeholder="Descripci√≥n" value="${e.descripcion}" onchange="actualizarEtapa(${i}, 'descripcion', this.value)">
                </div>
            `).join('');
            document.getElementById('etapasContainer').innerHTML = html;
        }

        function agregarEtapa() {
            const inputs = document.querySelectorAll('.etapa-editor-item input');
            const etapas = [];
            for (let i = 0; i < inputs.length; i += 2) {
                if (inputs[i].value) {
                    etapas.push({ nombre: inputs[i].value, descripcion: inputs[i + 1]?.value || '' });
                }
            }
            etapas.push({ nombre: '', descripcion: '' });
            renderizarEtapas(etapas);
        }

        function actualizarEtapa(idx, campo, valor) {}

        function cerrarModalEdicion() {
            document.getElementById('modalEdicion').style.display = 'none';
        }

        function cambiarTab(btn, tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function guardarTramite() {
            const nombre = document.getElementById('nombreTramite').value.trim();
            const clave = parseInt(document.getElementById('claveTramite').value);
            const estado = document.getElementById('estadoTramite').value;
            const categoriaId = parseInt(document.getElementById('categoriaTramite').value);
            const filtros = document.getElementById('filtrosTramite').value.trim();
            const descripcion = document.getElementById('descripcionTramite').value.trim();
            const requisitos = document.getElementById('requisitosTramite').value.trim();
            const presupuesto = document.getElementById('presupuestoTramite').value.trim();
            const resultado = document.getElementById('resultadoTramite').value.trim();
            const ordenesTrabajo = document.getElementById('ordenesTrabajo').value.split(',').map(o => o.trim()).filter(o => o);

            const inputs = document.querySelectorAll('.etapa-editor-item input');
            const etapas = [];
            for (let i = 0; i < inputs.length; i += 2) {
                if (inputs[i].value.trim()) {
                    etapas.push({ nombre: inputs[i].value.trim(), descripcion: inputs[i + 1]?.value.trim() || '' });
                }
            }

            if (!nombre || !clave || !categoriaId || !descripcion || !requisitos) {
                alert('‚ö†Ô∏è Completa campos obligatorios');
                return;
            }

            const categoria = datosGlobales.categorias.find(c => c.id === categoriaId);
            if (categoria.tramites.some(t => t.clave === clave)) {
                alert('‚ö†Ô∏è Clave duplicada');
                return;
            }

            accionPendiente = 'guardar';
            datosAccion = { nombre, clave, estado, categoriaId, filtros, descripcion, requisitos, etapas, presupuesto, resultado, ordenesTrabajo };
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordModal').style.display = 'block';
            document.getElementById('passwordInput').focus();
        }

        function verificarContrasena() {
            if (document.getElementById('passwordInput').value === CONTRASENA) {
                const { nombre, clave, estado, categoriaId, filtros, descripcion, requisitos, etapas, presupuesto, resultado, ordenesTrabajo } = datosAccion;
                const categoria = datosGlobales.categorias.find(c => c.id === categoriaId);
                categoria.tramites.push({ clave, nombre, estado, filtros, descripcion, requisitos, etapas, presupuesto, resultado, ordenesTrabajo });
                guardarDatos();
                cerrarModalEdicion();
                renderizar();
                alert('‚úÖ Tr√°mite agregado');
                document.getElementById('passwordModal').style.display = 'none';
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        function cerrarPasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
        }

        function resetFiltros() {
            document.getElementById('filtroNombre').value = '';
            document.getElementById('filtroCategoria').value = '';
            renderizar();
        }

        function guardarJSON() {
            const blob = new Blob([JSON.stringify(datosGlobales, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tramites_${Date.now()}.json`;
            a.click();
        }

        cargarDatos();
        const cats = datosGlobales.categorias.map(c => `<option value="${c.id}">${c.nombre}</option>`).join('');
        document.getElementById('filtroCategoria').innerHTML = '<option value="">Todas</option>' + cats;
        document.getElementById('categoriaTramite').innerHTML = cats;
        document.getElementById('filtroNombre').addEventListener('input', renderizar);
        document.getElementById('filtroCategoria').addEventListener('change', renderizar);
        document.getElementById('passwordInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') verificarContrasena(); });
        renderizar();
    </script>
</body>
</html>